const g="bs_auth_token";const p=["login","register","forgot-password","activation-code","reset-code","reset-password"],A=["login","register"],h={EMAIL_REGEX:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,PASSWORD_RULES:{"min-length":c=>c.length>=8,lowercase:c=>/[a-z]/.test(c),uppercase:c=>/[A-Z]/.test(c),digit:c=>/\d/.test(c),special:c=>/[^a-zA-Z0-9]/.test(c)},USERNAME_RULES:{"username-min":c=>c.length>=4,"username-chars":c=>c.length===0||/^[a-zA-Z0-9._-]+$/.test(c),"username-special":c=>(c.match(/[._-]/g)||[]).length<=2},CODE_REGEX:/^\d{6}$/};class q{constructor(t){this._cacheVersion=t||"0"}getToken(){return localStorage.getItem(g)}setToken(t){localStorage.setItem(g,t)}clearToken(){localStorage.removeItem(g)}}class P{constructor(t,e,s){this._restUrl=t,this._nonce=e,this._store=s,this._onUnauthorized=null}setUnauthorizedHandler(t){this._onUnauthorized=t}setNonce(t){this._nonce=t}post(t,e){return this._request("POST",t,e,!1)}postAuth(t,e){return this._request("POST",t,e,!0)}getAuth(t){const e=this._store.getToken(),s={"X-WP-Nonce":this._nonce};return e&&(s.Authorization="Bearer "+e),fetch(this._restUrl+t,{method:"GET",headers:s,credentials:"same-origin"}).then(a=>(a.status===401&&this._onUnauthorized&&this._onUnauthorized(),a.json()))}uploadAuth(t,e){const s=this._store.getToken(),a={"X-WP-Nonce":this._nonce};return s&&(a.Authorization="Bearer "+s),fetch(this._restUrl+t,{method:"POST",headers:a,credentials:"same-origin",body:e}).then(i=>i.json())}_request(t,e,s,a){const i={"Content-Type":"application/json","X-WP-Nonce":this._nonce};if(a){const r=this._store.getToken();r&&(i.Authorization="Bearer "+r)}return fetch(this._restUrl+e,{method:t,headers:i,credentials:"same-origin",body:JSON.stringify(s)}).then(r=>r.json())}}const v=30,_=10;class k{bindFields(t,e){const s=t.querySelectorAll("[data-ct-validate-required], [data-ct-validate-password], [data-ct-validate-email], [data-ct-validate-match], [data-ct-validate-code], [data-ct-validate-username], [data-ct-validate-agree]");for(let a=0;a<s.length&&a<v;a++){const i=s[a],r=i.type==="checkbox"?"change":"input";i.addEventListener(r,()=>{this._validateField(i,t),e&&e(this.isFormValid(t))}),i.type!=="checkbox"&&i.addEventListener("blur",()=>{this._validateField(i,t)})}}isFormValid(t){const e=t.querySelectorAll("[data-ct-validate-required], [data-ct-validate-password], [data-ct-validate-email], [data-ct-validate-match], [data-ct-validate-code], [data-ct-validate-username], [data-ct-validate-agree]");let s=0;for(let a=0;a<e.length&&a<v;a++){const i=e[a];if(s++,!this._isFieldValid(i,t))return!1}return s>0}validateAll(t){const e=t.querySelectorAll("[data-ct-validate-required], [data-ct-validate-password], [data-ct-validate-email], [data-ct-validate-match], [data-ct-validate-code], [data-ct-validate-username], [data-ct-validate-agree]");for(let s=0;s<e.length&&s<v;s++){const a=e[s],i=this._isFieldValid(a,t);if(a.hasAttribute("data-ct-validate-agree")){this._validateAgreeRules(a);continue}if(a.hasAttribute("data-ct-validate-password")){this._validatePasswordRules(a,t);const r=a.closest(".ct-auth-form__field"),l=r?r.querySelector(".ct-auth-form__validation"):null;if(l&&a.value.length===0){l.classList.remove("ct-auth-form__validation--hidden");const o=l.querySelectorAll(".ct-auth-form__rule");for(let n=0;n<o.length&&n<_;n++)o[n].classList.add("ct-auth-form__rule--fail"),o[n].classList.remove("ct-auth-form__rule--pass")}a.classList.toggle("ct-auth-form__input--valid",i),a.classList.toggle("ct-auth-form__input--invalid",!i);continue}if(a.hasAttribute("data-ct-validate-username")){this._validateUsernameRules(a);const r=a.closest(".ct-auth-form__field"),l=r?r.querySelector(".ct-auth-form__validation"):null;if(l&&a.value.length===0){l.classList.remove("ct-auth-form__validation--hidden");const o=l.querySelectorAll(".ct-auth-form__rule");for(let n=0;n<o.length&&n<_;n++)o[n].classList.add("ct-auth-form__rule--fail"),o[n].classList.remove("ct-auth-form__rule--pass")}a.classList.toggle("ct-auth-form__input--valid",i),a.classList.toggle("ct-auth-form__input--invalid",!i);continue}if(a.hasAttribute("data-ct-validate-email")){this._validateEmailRules(a,!0);continue}if(a.hasAttribute("data-ct-validate-match")){this._updateMatchUI(a,t),a.value.length===0&&(a.classList.remove("ct-auth-form__input--valid"),a.classList.add("ct-auth-form__input--invalid"));continue}if(this._isRequiredOnly(a)){this._validateRequiredRules(a,!0);continue}}}_validateField(t,e){const s=t.value;if(t.hasAttribute("data-ct-validate-password")){this._validatePasswordRules(t,e);const a=this._isFieldValid(t,e);t.classList.toggle("ct-auth-form__input--valid",a&&s.length>0),t.classList.toggle("ct-auth-form__input--invalid",!a&&s.length>0)}if(t.name==="current_password"){const a=e.querySelector('input[name="new_password"]');a&&a.hasAttribute("data-ct-validate-password")&&this._validatePasswordRules(a,e)}if(t.hasAttribute("data-ct-validate-username")){this._validateUsernameRules(t);const a=this._isFieldValid(t,e);t.classList.toggle("ct-auth-form__input--valid",a&&s.length>0),t.classList.toggle("ct-auth-form__input--invalid",!a&&s.length>0)}if(t.hasAttribute("data-ct-validate-email")&&this._validateEmailRules(t,!1),this._isRequiredOnly(t)&&this._validateRequiredRules(t,!1),t.hasAttribute("data-ct-validate-agree")&&this._validateAgreeRules(t),t.hasAttribute("data-ct-validate-match")&&this._updateMatchUI(t,e),t.name){const a=e.querySelector('[data-ct-validate-match="'+t.name+'"]');a&&this._updateMatchUI(a,e)}}_isRequiredOnly(t){return t.hasAttribute("data-ct-validate-required")&&!t.hasAttribute("data-ct-validate-password")&&!t.hasAttribute("data-ct-validate-username")&&!t.hasAttribute("data-ct-validate-email")&&!t.hasAttribute("data-ct-validate-match")&&!t.hasAttribute("data-ct-validate-code")&&!t.hasAttribute("data-ct-validate-agree")}_validateEmailRules(t,e){const s=t.value,a=t.closest(".ct-auth-form__field"),i=a?a.querySelector(".ct-auth-form__validation"):null,r=s.length===0,l=!r&&h.EMAIL_REGEX.test(s);if(t.classList.toggle("ct-auth-form__input--valid",l),t.classList.toggle("ct-auth-form__input--invalid",e&&r||!r&&!l),!i)return;if(!e&&r){i.classList.add("ct-auth-form__validation--hidden");return}i.classList.remove("ct-auth-form__validation--hidden");const o=i.querySelectorAll(".ct-auth-form__rule");for(let n=0;n<o.length&&n<_;n++)o[n].classList.toggle("ct-auth-form__rule--pass",l),o[n].classList.toggle("ct-auth-form__rule--fail",!l)}_validateRequiredRules(t,e){const s=t.value.trim(),a=t.closest(".ct-auth-form__field"),i=a?a.querySelector(".ct-auth-form__validation"):null,r=s.length>0;if(t.classList.toggle("ct-auth-form__input--valid",r),t.classList.toggle("ct-auth-form__input--invalid",e&&!r),!!i){if(!e&&!r){i.classList.add("ct-auth-form__validation--hidden");return}if(r)i.classList.add("ct-auth-form__validation--hidden");else{i.classList.remove("ct-auth-form__validation--hidden");const l=i.querySelectorAll(".ct-auth-form__rule");for(let o=0;o<l.length&&o<_;o++)l[o].classList.add("ct-auth-form__rule--fail"),l[o].classList.remove("ct-auth-form__rule--pass")}}}_validateAgreeRules(t){const e=t.checked,s=t.closest(".ct-auth-form__agree"),a=s?s.querySelector(".ct-auth-form__validation"):null;if(a)if(e)a.classList.add("ct-auth-form__validation--hidden");else{a.classList.remove("ct-auth-form__validation--hidden");const i=a.querySelectorAll(".ct-auth-form__rule");for(let r=0;r<i.length&&r<_;r++)i[r].classList.add("ct-auth-form__rule--fail"),i[r].classList.remove("ct-auth-form__rule--pass")}}_updateMatchUI(t,e){const s=t.getAttribute("data-ct-validate-match"),a=e.querySelector('input[name="'+s+'"]');if(!a)return;const i=t.value,r=i===a.value&&i.length>0;t.classList.toggle("ct-auth-form__input--valid",r),t.classList.toggle("ct-auth-form__input--invalid",i.length>0&&!r);const l=t.closest(".ct-auth-form__field").querySelector(".ct-auth-form__match-hint");l&&(l.classList.toggle("ct-auth-form__match-hint--pass",r),l.classList.toggle("ct-auth-form__match-hint--fail",i.length>0&&!r),l.classList.toggle("ct-auth-form__match-hint--hidden",i.length===0))}_validatePasswordRules(t,e){const s=t.value,a=t.closest(".ct-auth-form__field"),i=a?a.querySelector(".ct-auth-form__validation"):null;if(!i)return;i.classList.toggle("ct-auth-form__validation--hidden",s.length===0);const r=i.querySelectorAll(".ct-auth-form__rule");for(let l=0;l<r.length&&l<_;l++){const o=r[l],n=o.getAttribute("data-rule");if(n==="different"){const f=o.getAttribute("data-rule-compare");if(f&&e){const w=e.querySelector('input[name="'+f+'"]'),m=w?w.value:"",b=s.length>0&&m.length>0,L=b&&s!==m,S=b&&s===m;o.classList.toggle("ct-auth-form__rule--pass",L),o.classList.toggle("ct-auth-form__rule--info",S),o.classList.remove("ct-auth-form__rule--fail")}continue}if(!n||!h.PASSWORD_RULES[n])continue;const u=h.PASSWORD_RULES[n](s);o.classList.toggle("ct-auth-form__rule--pass",u),o.classList.toggle("ct-auth-form__rule--fail",s.length>0&&!u)}}_validateUsernameRules(t){const e=t.value,s=t.closest(".ct-auth-form__field"),a=s?s.querySelector(".ct-auth-form__validation"):null;if(!a)return;a.classList.toggle("ct-auth-form__validation--hidden",e.length===0);const i=a.querySelectorAll(".ct-auth-form__rule");for(let r=0;r<i.length&&r<_;r++){const l=i[r],o=l.getAttribute("data-rule");if(!o||!h.USERNAME_RULES[o])continue;const n=h.USERNAME_RULES[o](e);l.classList.toggle("ct-auth-form__rule--pass",n),l.classList.toggle("ct-auth-form__rule--fail",e.length>0&&!n)}}_isFieldValid(t,e){if(t.hasAttribute("data-ct-validate-agree"))return t.checked===!0;const s=t.value.trim();if(t.hasAttribute("data-ct-validate-required")&&s.length===0)return!1;if(t.hasAttribute("data-ct-validate-min")){const a=parseInt(t.getAttribute("data-ct-validate-min"),10);if(s.length<a)return!1}if(t.hasAttribute("data-ct-validate-email")&&!h.EMAIL_REGEX.test(s))return!1;if(t.hasAttribute("data-ct-validate-password")){const a=h.PASSWORD_RULES,i=Object.keys(a);for(let o=0;o<i.length&&o<_;o++)if(!a[i[o]](s))return!1;const r=t.closest(".ct-auth-form__field"),l=r?r.querySelector('.ct-auth-form__rule[data-rule="different"]'):null;if(l){const o=l.getAttribute("data-rule-compare");if(o){const n=e.querySelector('input[name="'+o+'"]');if(n&&n.value.length>0&&s===n.value)return!1}}}if(t.hasAttribute("data-ct-validate-username")){const a=h.USERNAME_RULES,i=Object.keys(a);for(let r=0;r<i.length&&r<_;r++)if(!a[i[r]](s))return!1}if(t.hasAttribute("data-ct-validate-match")){const a=t.getAttribute("data-ct-validate-match"),i=e.querySelector('input[name="'+a+'"]');if(i&&s!==i.value)return!1}return!(t.hasAttribute("data-ct-validate-code")&&!h.CODE_REGEX.test(s))}}const E=10;class M{constructor(){this._validator=new k}bind(t){if(!t)return;const e=t.querySelector(".ct-auth-form");if(!e)return;const s=e.querySelector(".ct-auth-form__submit--disabled");s?(this._validator.bindFields(e,a=>{s.disabled=!a,s.classList.toggle("ct-auth-form__submit--disabled",!a)}),this._bindEnterSubmit(e,s),this._bindAgreeCheckbox(e,s)):this._validator.bindFields(e,null),this._bindPasswordToggles(e)}_bindEnterSubmit(t,e){t.addEventListener("keydown",s=>{s.key==="Enter"&&s.target.tagName!=="TEXTAREA"&&(s.preventDefault(),e.disabled||e.click())})}_bindAgreeCheckbox(t,e){const s=t.querySelector("[data-ct-validate-agree]");s&&s.addEventListener("change",()=>{this._validator.validateAll(t);const a=this._validator.isFormValid(t);e.disabled=!a,e.classList.toggle("ct-auth-form__submit--disabled",!a)})}_bindPasswordToggles(t){const e=t.querySelectorAll(".ct-auth-form__password-toggle");for(let s=0;s<e.length&&s<E;s++){const a=e[s],i=a.closest(".ct-auth-form__password-wrap");if(!i)continue;const r=i.querySelector("input");r&&a.addEventListener("click",()=>{const l=r.type==="text";r.type=l?"password":"text",a.classList.toggle("ct-auth-form__password-toggle--active",!l)})}}getValidator(){return this._validator}}function d(c,t){if(!c)throw new Error("Assertion failed: "+(t||""))}class y{constructor(){d(typeof document<"u","document must exist"),d(typeof window<"u","window must exist"),this._card=document.querySelector(".ct-auth-card"),this._card&&(this._restUrl=this._card.getAttribute("data-rest-url")||"",this._nonce=this._card.getAttribute("data-nonce")||"",this._cacheVersion=this._card.getAttribute("data-cache-version")||"0",this._homeUrl=this._card.getAttribute("data-home-url")||"/",this._emailEnabled=this._card.getAttribute("data-email-enabled")!=="0",d(typeof this._restUrl=="string","restUrl must be a string"),d(typeof this._nonce=="string","nonce must be a string"),this._flowData={},this._overlay=null,this._initSubSystems(),this._bindAllForms(),this._bindActions(),this._handleHashNavigation())}_initSubSystems(){this._store=new q(this._cacheVersion),this._api=new P(this._restUrl,this._nonce,this._store),this._binder=new M,this._api.setUnauthorizedHandler(()=>{this._flowData={},this._showForm("login")})}_bindAllForms(){d(this._card instanceof HTMLElement,"card must be HTMLElement");const t=this._card.querySelectorAll("[data-ct-auth-form]"),e=t.length;for(let s=0;s<e;s++)this._binder.bind(t[s])}_bindActions(){d(typeof this._card.addEventListener=="function","addEventListener must exist"),d(this._card!==null,"card must exist"),this._card.addEventListener("click",t=>{const e=t.target.closest("[data-ct-auth-action]");if(!e)return;t.preventDefault();const s=e.getAttribute("data-ct-auth-action");this._handleAction(s)}),this._card.addEventListener("click",t=>{const e=t.target.closest("[data-ct-auth-tab]");if(!e)return;t.preventDefault();const s=e.getAttribute("data-ct-auth-tab");this._showForm(s)})}_handleHashNavigation(){window.location.hash==="#register"&&this._showForm("register")}_handleAction(t){if(!this._emailEnabled&&["show-forgot","forgot","verify-activation","verify-reset-code","reset-password","resend-reset-code","resend-activation-code"].includes(t))return;switch(d(typeof t=="string","action must be a string"),d(t.length>0,"action must not be empty"),t){case"show-forgot":this._showForm("forgot-password");break;case"show-login":this._showForm("login");break;case"show-register":this._showForm("register");break;case"back-to-login":this._flowData={},this._showForm("login");break;case"login":this._submitLogin();break;case"register":this._submitRegister();break;case"forgot":this._submitForgotPassword();break;case"verify-activation":this._submitVerifyActivation();break;case"verify-reset-code":this._submitVerifyResetCode();break;case"reset-password":this._submitResetPassword();break;case"resend-reset-code":this._resendResetCode();break;case"resend-activation-code":this._resendActivationCode();break}}_showForm(t){d(typeof t=="string","name must be a string");const e=this._card.querySelectorAll("[data-ct-auth-form]"),s=this._card.querySelector('[data-ct-auth-form="'+t+'"]');if(!s)return;const n=e.length;for(let o=0;o<n;o++){const n=e[o].getAttribute("data-ct-auth-form")===t;e[o].classList.toggle("ct-auth-card__panel--active",n)}const a=this._isTabForm(t),i=this._card.querySelector(".ct-auth-card__tabs"),r=this._card.querySelector("[data-ct-auth-back-bar]");if(i&&(i.style.display=a?"":"none"),r&&(r.style.display=a?"none":""),a){const o=this._card.querySelectorAll("[data-ct-auth-tab]"),n=5;for(let u=0;u<o.length&&u<n;u++){const f=o[u].getAttribute("data-ct-auth-tab")===t;o[u].classList.toggle("ct-auth-card__tab--active",f),o[u].setAttribute("aria-selected",f?"true":"false")}}this._injectFlowData(t);const l=this._getActivePanel();if(l){this._clearMessages(l);const o=l.querySelector(".ct-auth-form__input:not([readonly])");o&&o.focus()}}_getActivePanel(){return this._card.querySelector(".ct-auth-card__panel--active")}_isTabForm(t){for(let e=0;e<A.length;e++)if(A[e]===t)return!0;return!1}_injectFlowData(t){const e=this._getActivePanel();if(e){if(t==="activation-code"||t==="reset-code"){const s=e.querySelector('input[name="email"]');s&&this._flowData.email&&(s.value=this._flowData.email)}if(t==="reset-password"){const s=e.querySelector('input[name="reset_token"]');s&&this._flowData.reset_token&&(s.value=this._flowData.reset_token)}}}_submitLogin(){const t=this._getActivePanel();if(!t)return;const e=t.querySelector('input[name="username_or_email"]'),s=t.querySelector('input[name="password"]');if(!e||!s)return;const a=e.value.trim(),i=s.value;if(!a||!i){this._showMessage(t,"error","Please fill in all fields.");return}this._setLoading(t,!0),this._clearMessages(t),this._blockPage(),this._api.post("login",{username_or_email:a,password:i}).then(r=>{r.success&&r.data?(r.data.token&&this._store.setToken(r.data.token),r.data.nonce&&(this._nonce=r.data.nonce,this._api.setNonce(r.data.nonce)),this._redirectAfterLogin()):(this._setLoading(t,!1),this._unblockPage(),r.data&&r.data.requires_activation?(this._emailEnabled?(this._flowData.email=r.data.email||"",this._showForm("activation-code")):this._showMessage(t,"error",r.message||"Login failed.")):this._showMessage(t,"error",r.message||"Login failed."))}).catch(()=>{this._setLoading(t,!1),this._unblockPage(),this._showMessage(t,"error","An error occurred. Please try again.")})}_submitRegister(){const t=this._getActivePanel();if(!t)return;const e=t.querySelector(".ct-auth-form"),s=t.querySelector("[data-ct-validate-agree]");if(s&&!s.checked){e&&this._binder.getValidator().validateAll(e),this._showMessage(t,"error","You must agree to the Terms and Conditions.");return}const a={username:t.querySelector('input[name="username"]'),email:t.querySelector('input[name="email"]'),first_name:t.querySelector('input[name="first_name"]'),last_name:t.querySelector('input[name="last_name"]'),password:t.querySelector('input[name="password"]'),password_confirm:t.querySelector('input[name="password_confirm"]')};if(!a.username||!a.email)return;const i={},r=Object.keys(a);for(let l=0;l<r.length&&l<20;l++)a[r[l]]&&(i[r[l]]=a[r[l]].value.trim());if(!i.username||!i.email||!i.first_name||!i.last_name||!i.password||!i.password_confirm){e&&this._binder.getValidator().validateAll(e),this._showMessage(t,"error","Please fill in all fields.");return}if(i.password!==i.password_confirm){this._showMessage(t,"error","Passwords do not match.");return}if(i.password.length<8){this._showMessage(t,"error","Password must be at least 8 characters.");return}this._setLoading(t,!0),this._clearMessages(t),this._blockPage(),this._api.post("register",i).then(l=>{if(this._setLoading(t,!1),this._unblockPage(),l.success){if(!this._emailEnabled){this._flowData={},this._showForm("login");const o=this._getActivePanel();o&&this._showMessage(o,"success","Account created. You can now log in.");return}const o=l.data&&l.data.email?l.data.email:i.email;this._flowData.email=o,this._showForm("activation-code")}else this._showMessage(t,"error",l.message||"Registration failed.")}).catch(()=>{this._setLoading(t,!1),this._unblockPage(),this._showMessage(t,"error","An error occurred. Please try again.")})}_submitForgotPassword(){if(!this._emailEnabled)return;const t=this._getActivePanel();if(!t)return;const e=t.querySelector('input[name="email"]');if(!e)return;const s=e.value.trim();if(!s){this._showMessage(t,"error","Please enter your email address.");return}this._setLoading(t,!0),this._clearMessages(t),this._blockPage(),this._api.post("forgot-password",{email:s}).then(()=>{this._setLoading(t,!1),this._unblockPage(),this._flowData.email=s,this._showForm("reset-code")}).catch(()=>{this._setLoading(t,!1),this._unblockPage(),this._showMessage(t,"error","An error occurred. Please try again.")})}_resendResetCode(){if(!this._emailEnabled)return;const t=this._getActivePanel();if(!t)return;const e=this._flowData.email||"";if(!e){this._showMessage(t,"error","Session expired. Please start over.");return}this._setLoading(t,!0),this._clearMessages(t),this._api.post("forgot-password",{email:e}).then(()=>{this._setLoading(t,!1),this._showMessage(t,"success","A new code has been sent to your email.");const s=t.querySelector('input[name="code"]');s&&(s.value="",s.focus())}).catch(()=>{this._setLoading(t,!1),this._showMessage(t,"error","An error occurred. Please try again.")})}_resendActivationCode(){if(!this._emailEnabled)return;const t=this._getActivePanel();if(!t)return;const e=this._flowData.email||"";if(!e){this._showMessage(t,"error","Session expired. Please start over.");return}this._setLoading(t,!0),this._clearMessages(t),this._api.post("resend-activation",{email:e}).then(()=>{this._setLoading(t,!1),this._showMessage(t,"success","A new activation code has been sent to your email.");const s=t.querySelector('input[name="code"]');s&&(s.value="",s.focus())}).catch(()=>{this._setLoading(t,!1),this._showMessage(t,"error","An error occurred. Please try again.")})}_submitVerifyActivation(){if(!this._emailEnabled)return;const t=this._getActivePanel();if(!t)return;const e=t.querySelector('input[name="code"]'),s=t.querySelector('input[name="email"]');if(!e||!s)return;const a=e.value.trim(),i=s.value.trim();if(!a||!i){this._showMessage(t,"error","Please enter the 6-digit code.");return}this._setLoading(t,!0),this._clearMessages(t),this._api.post("verify-activation",{email:i,code:a}).then(r=>{this._setLoading(t,!1),r.success?(this._showMessage(t,"success",r.message||"Account activated! You can now log in."),this._flowData={},setTimeout(()=>{this._showForm("login")},1500)):this._showMessage(t,"error",r.message||"Invalid code.")}).catch(()=>{this._setLoading(t,!1),this._showMessage(t,"error","An error occurred. Please try again.")})}_submitVerifyResetCode(){if(!this._emailEnabled)return;const t=this._getActivePanel();if(!t)return;const e=t.querySelector('input[name="code"]'),s=t.querySelector('input[name="email"]');if(!e||!s)return;const a=e.value.trim(),i=s.value.trim();if(!a||!i){this._showMessage(t,"error","Please enter the 6-digit code.");return}this._setLoading(t,!0),this._clearMessages(t),this._api.post("verify-reset-code",{email:i,code:a}).then(r=>{this._setLoading(t,!1),r.success&&r.data&&r.data.reset_token?(this._flowData.reset_token=r.data.reset_token,this._showForm("reset-password")):this._showMessage(t,"error",r.message||"Invalid code.")}).catch(()=>{this._setLoading(t,!1),this._showMessage(t,"error","An error occurred. Please try again.")})}_submitResetPassword(){if(!this._emailEnabled)return;const t=this._getActivePanel();if(!t)return;const e=t.querySelector('input[name="new_password"]'),s=t.querySelector('input[name="new_password_confirm"]'),a=t.querySelector('input[name="reset_token"]');if(!e||!s||!a)return;const i=e.value,r=s.value,l=a.value;if(!i||!r){this._showMessage(t,"error","Please fill in all password fields.");return}if(i!==r){this._showMessage(t,"error","Passwords do not match.");return}if(i.length<8){this._showMessage(t,"error","Password must be at least 8 characters.");return}if(!l){this._showMessage(t,"error","Reset session expired. Please start over.");return}this._setLoading(t,!0),this._clearMessages(t),this._api.post("reset-password",{reset_token:l,new_password:i,new_password_confirm:r}).then(o=>{this._setLoading(t,!1),o.success?(this._showMessage(t,"success",o.message||"Password reset! You can now log in."),this._flowData={},this._blockPage(),setTimeout(()=>{window.location.href=window.location.pathname},1500)):this._showMessage(t,"error",o.message||"Password reset failed.")}).catch(()=>{this._setLoading(t,!1),this._showMessage(t,"error","An error occurred. Please try again.")})}_redirectAfterLogin(){d(typeof window.location<"u","window.location must exist");const e=new URLSearchParams(window.location.search).get("redirect_to");e?window.location.href=e:window.location.href=this._homeUrl}_showMessage(t,e,s){if(!t||!(t instanceof HTMLElement))return;const a=t.querySelector(".ct-auth-form__messages");if(!a)return;a.innerHTML="";const i=document.createElement("div");i.className="ct-auth-form__message fs14 ct-auth-form__message--"+e,i.textContent=s,a.appendChild(i)}_clearMessages(t){if(!t)return;const e=t.querySelector(".ct-auth-form__messages");e&&(e.innerHTML="")}_setLoading(t,e){if(!t||!(t instanceof HTMLElement))return;const s=t.querySelector(".ct-auth-form__submit");s&&(s.disabled=e,e?s.classList.add("ct-auth-form__submit--loading"):s.classList.remove("ct-auth-form__submit--loading"))}_blockPage(){if(this._overlay)return;const t=document.createElement("div");t.style.cssText="position:fixed;inset:0;z-index:99999;cursor:not-allowed;",document.body.appendChild(t),this._overlay=t}_unblockPage(){this._overlay&&(this._overlay.remove(),this._overlay=null)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{new y}):new y;
